/* Manipulate vcf file to create binary indicator for het/hom/missing data */

libname sim "/home/fnew/mclab/ethanol/Sim_Pop_Gen/sas_data";
libname sim "/home/fnew/ufgi_share/SHARE/McIntyre_Lab/ethanol/Sim_Pop_Gen/sas_data";

proc import datafile = '/home/fnew/dsim/sim_chr2L_biallele.recode.vcf'
 out=vcf_2L
    dbms=TAB REPLACE;
    delimiter='09'x;
    datarow=2; getnames=yes;
    run;

proc import datafile = '/home/fnew/dsim/sim_biall_chr_indiv_filt_no_missing.recode.vcf'
  out=vcf_nomiss
    dbms=TAB REPLACE;
    delimiter='09'x;
    datarow=2; getnames=yes;
    run;

%include '/home/fnew/mclab/ethanol/Sim_Pop_Gen/sas_programs/sample_list.txt';
%put &mylist;
%include '/home/fnew/mclab/macros/iterlist.sas';

*I only want the genotype field, 0/0 0/1 1/1, ;
%iterlist(list= &mylist., code = %nrstr(%trimm(?); ); );

%macro trimm(line);
    data &line;
    set vcf_2l;
    &line = substr(&line, ,1,3);
    run;
    %mend;


%combine();
    data vcf_all;
    set
    %do i =  %to;
        file&i
        %end;
        ;
        run;
    %mend;
%combine;



%macro fix(chrom);
data dsim.vcf_&chrom._nomiss;
        set vcf_&chrom;
        Sz100 = substr(sz100,1,3);
        *ste= substr(ste,1,3);
        *md106=substr(md106,1,3);
        *c167_4=substr(c167_4,1,3);
        *md199=substr(md199,1,3);
        *_128=substr(_128,1,3);
        *_176=substr(_176,1,3);
        *_132=substr(_132,1,3);
        *_74=substr(_74,1,3);
        *_84=substr(_84,1,3);
        sz101=substr(sz101,1,3);
        sz102=substr(sz102,1,3);
        sz103=substr(sz103,1,3);
        sz106=substr(sz106,1,3);
        *sz11=substr(sz11,1,3);
        sz110=substr(sz110,1,3);
        sz111=substr(sz111,1,3);
        sz113=substr(sz113,1,3);
        sz115=substr(sz115,1,3);
        *sz116=substr(sz116,1,3);
        sz12=substr(sz12,1,3);
        sz120=substr(sz120,1,3);
        *sz121=substr(sz121,1,3);
        sz123=substr(sz123,1,3);
        sz124=substr(sz124,1,3);
        sz125=substr(sz125,1,3);
        sz126=substr(sz126,1,3);
        sz127=substr(sz127,1,3);
        sz128=substr(sz128,1,3);
        sz129=substr(sz129,1,3);
        sz13=substr(sz13,1,3);
        sz130=substr(sz130,1,3);
        sz131=substr(sz131,1,3);
        sz133=substr(sz133,1,3);
        sz135=substr(sz135,1,3);
        sz136=substr(sz136,1,3);
        sz137=substr(sz137,1,3);
        sz138=substr(sz138,1,3);
        sz139=substr(sz139,1,3);
        sz14=substr(sz14,1,3);
        sz140=substr(sz140,1,3);
        sz141=substr(sz141,1,3);
        sz142=substr(sz142,1,3);
        sz143=substr(sz143,1,3);
        sz145=substr(sz145,1,3);
        sz146=substr(sz146,1,3);
        sz149=substr(sz149,1,3);
        sz15=substr(sz15,1,3);
        sz151=substr(sz151,1,3);
        sz153=substr(sz153,1,3);
        sz154=substr(sz154,1,3);
        sz155=substr(sz155,1,3);
        *sz158=substr(sz158,1,3);
        sz16=substr(sz16,1,3);
        sz160=substr(sz160,1,3);
        sz162=substr(sz162,1,3);
        sz163=substr(sz163,1,3);
        sz164=substr(sz164,1,3);
        sz166=substr(sz166,1,3);
        sz168=substr(sz168,1,3);
        sz169=substr(sz169,1,3);
        sz172=substr(sz172,1,3);
        sz173=substr(sz173,1,3);
        sz175=substr(sz175,1,3);
        *sz176=substr(sz176,1,3);
        sz181=substr(sz181,1,3);
        sz182=substr(sz182,1,3);
        sz184=substr(sz184,1,3);
        sz185=substr(sz185,1,3);
        sz186=substr(sz186,1,3);
        sz189=substr(sz189,1,3);
        *sz19=substr(sz19,1,3);
        sz190=substr(sz190,1,3);
        sz191=substr(sz191,1,3);
        sz193=substr(sz193,1,3);
        sz194=substr(sz194,1,3);
        sz196=substr(sz196,1,3);
        sz197=substr(sz197,1,3);
        sz199=substr(sz199,1,3);
        sz200=substr(sz200,1,3);
        sz201=substr(sz201,1,3);
        sz202=substr(sz202,1,3);
        sz203=substr(sz203,1,3);
        sz204=substr(sz204,1,3);
        sz205=substr(sz205,1,3);
        sz207=substr(sz207,1,3);
        sz208=substr(sz208,1,3);
        sz209=substr(sz209,1,3);
        *sz21=substr(sz21,1,3);
        *sz210=substr(sz210,1,3);
        sz211=substr(sz211,1,3);
        sz212=substr(sz212,1,3);
        sz213=substr(sz213,1,3);
        sz214=substr(sz214,1,3);
        sz217=substr(sz217,1,3);
        sz218=substr(sz218,1,3);
        sz22=substr(sz22,1,3);
        sz220=substr(sz220,1,3);
        sz223=substr(sz223,1,3);
        sz225=substr(sz225,1,3);
        sz226=substr(sz226,1,3);
        sz228=substr(sz228,1,3);
        sz229=substr(sz229,1,3);
        sz232=substr(sz232,1,3);
        sz233=substr(sz233,1,3);
        sz234=substr(sz234,1,3);
        sz236=substr(sz236,1,3);
        *sz237=substr(sz237,1,3);
        sz238=substr(sz238,1,3);
        sz24=substr(sz24,1,3);
        sz240=substr(sz240,1,3);
        sz241=substr(sz241,1,3);
        sz243=substr(sz243,1,3);
        sz244=substr(sz244,1,3);
        sz246=substr(sz246,1,3);
        sz248=substr(sz248,1,3);
        sz249=substr(sz249,1,3);
        sz252=substr(sz252,1,3);
        sz253=substr(sz253,1,3);
        sz254=substr(sz254,1,3);
        sz257=substr(sz257,1,3);
        sz259=substr(sz259,1,3);
        sz26=substr(sz26,1,3);
        sz261=substr(sz261,1,3);
        sz262=substr(sz262,1,3);
        sz265=substr(sz265,1,3);
        sz266=substr(sz266,1,3);
        sz267=substr(sz267,1,3);
        sz268=substr(sz268,1,3);
        sz27=substr(sz27,1,3);
        sz270=substr(sz270,1,3);
        sz271=substr(sz271,1,3);
        sz272=substr(sz272,1,3);
        sz274=substr(sz274,1,3);
        sz275=substr(sz275,1,3);
        sz281=substr(sz281,1,3);
        sz282=substr(sz282,1,3);
        sz285=substr(sz285,1,3);
        *sz286=substr(sz286,1,3);
        sz287=substr(sz287,1,3);
        sz288=substr(sz288,1,3);
        sz289=substr(sz289,1,3);
        sz29=substr(sz29,1,3);
        sz291=substr(sz291,1,3);
        sz293=substr(sz293,1,3);
        sz298=substr(sz298,1,3);
        sz299=substr(sz299,1,3);
        sz3=substr(sz3,1,3);
        sz30=substr(sz30,1,3);
        sz31=substr(sz31,1,3);
        sz33=substr(sz33,1,3);
        sz37=substr(sz37,1,3);
        sz39=substr(sz39,1,3);
        sz4=substr(sz4,1,3);
        sz40=substr(sz40,1,3);
        sz41=substr(sz41,1,3);
        sz43=substr(sz43,1,3);
        sz45=substr(sz45,1,3);
        sz46=substr(sz46,1,3);
        sz47=substr(sz47,1,3);
        sz48=substr(sz48,1,3);
        sz49=substr(sz49,1,3);
        sz5=substr(sz5,1,3);
        sz52=substr(sz52,1,3);
        sz53=substr(sz53,1,3);
        sz54=substr(sz54,1,3);
        sz56=substr(sz56,1,3);
        *sz57=substr(sz57,1,3);
        sz58=substr(sz58,1,3);
        sz6=substr(sz6,1,3);
        sz60=substr(sz60,1,3);
        sz62=substr(sz62,1,3);
        sz64=substr(sz64,1,3);
        sz65=substr(sz65,1,3);
        sz68=substr(sz68,1,3);
        sz71=substr(sz71,1,3);
        sz75=substr(sz75,1,3);
        *sz76=substr(sz76,1,3);
        sz77=substr(sz77,1,3);
        sz8=substr(sz8,1,3);
        sz80=substr(sz80,1,3);
        sz82=substr(sz82,1,3);
        sz83=substr(sz83,1,3);
        sz84=substr(sz84,1,3);
        sz87=substr(sz87,1,3);
        sz9=substr(sz9,1,3);
        sz90=substr(sz90,1,3);
        sz91=substr(sz91,1,3);
        sz93=substr(sz93,1,3);
        sz97=substr(sz97,1,3);
        sz99=substr(sz99,1,3);
        *md106ts=substr(md106ts,1,3);
        *nc485=substr(nc485,1,3);
        *newc=substr(newc,1,3);
        *w501=substr(w501,1,3);
    run;
%mend;
  

%fix(4);
%fix(2L);
%fix(2R);
%fix(3L);
%fix(3R);
%fix(X);

%iterlist( list=&mylist., code= %nrstr(data trim_2r; set vcf_2r; ?=substr(?,1,3); run;));

proc freq data=sim.vcf_nomiss;
tables sz: newc w501 nc485 _176 _132 _74 _84 md199 md106 c167_4;
run;
