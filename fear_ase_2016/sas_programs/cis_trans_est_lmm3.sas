data test;
input 
geno $ ms $ fusionid $	ai	both line	tester	old_cis_line old_cis_tester old_trans_line old_trans_tester mean_apn;
cards;
r101	M	F10005_SI	0	1274	155	133	28.666667	6.666667	-448.133333	-6.666667	29.523922
r280	M	F10005_SI	0	1208	126	143	-10.333333	6.666667	-428.133333	-6.666667	27.917307
r315	M	F10005_SI	0	1231	237	218	25.666667	6.666667	-278.133333	-6.666667	31.867690
r324	M	F10005_SI	1	2554	349	276	79.666667	6.666667	-162.133333	-6.666667	60.087419
r335	M	F10005_SI	0	1339	215	217	4.666667	6.666667	-280.133333	-6.666667	33.474306
r340	M	F10005_SI	1	1897	332	102	236.666667	6.666667	-510.133333	-6.666667	44.059067
r357	M	F10005_SI	1	2797	358	408	-43.333333	6.666667	101.866667	-6.666667	67.345540
r358	M	F10005_SI	0	1494	185	162	29.666667	6.666667	-390.133333	-6.666667	34.797401
r365	M	F10005_SI	0	2313	385	386	5.666667	6.666667	57.866667	-6.666667	58.291790
r373	M	F10005_SI	0	1546	146	113	39.666667	6.666667	-488.133333	-6.666667	34.116952
r374	M	F10005_SI	0	1703	231	155	82.666667	6.666667	-404.133333	-6.666667	39.484938
r380	M	F10005_SI	0	1584	295	254	47.666667	6.666667	-206.133333	-6.666667	40.316598
r427	M	F10005_SI	0	4246	522	510	18.666667	6.666667	305.866667	-6.666667	99.761370
r491	M	F10005_SI	0	3827	657	599	64.666667	6.666667	483.866667	-6.666667	96.075605
r517	M	F10005_SI	0	2591	580	520	66.666667	6.666667	325.866667	-6.666667	69.764914
r732	M	F10005_SI	0	1281	276	237	45.666667	6.666667	-240.133333	-6.666667	33.909037
r737	M	F10005_SI	0	1576	126	156	-23.333333	6.666667	-402.133333	-6.666667	35.118724
r799	M	F10005_SI	0	2798	520	480	46.666667	6.666667	245.866667	-6.666667	71.787360
r820	M	F10005_SI	0	1880	236	180	62.666667	6.666667	-354.133333	-6.666667	43.397519
r85	M	F10005_SI	0	1086	131	191	-53.333333	6.666667	-332.133333	-6.666667	26.613113
w114	M	F10005_SI	0	1042	230	243	-6.333333	6.666667	-228.133333	-6.666667	28.635558
w38	M	F10005_SI	1	2046	444	501	-50.333333	6.666667	287.866667	-6.666667	56.533963
w47	M	F10005_SI	0	5492	1425	1417	14.666667	6.666667	2119.866667	-6.666667	157.523922
w52	M	F10005_SI	0	3848	407	397	16.666667	6.666667	79.866667	-6.666667	87.929120
w55	M	F10005_SI	1	4191	252	882	-623.333333	6.666667	1049.866667	-6.666667	100.649734
w59	M	F10005_SI	0	1429	367	329	44.666667	6.666667	-56.133333	-6.666667	40.165387
w64	M	F10005_SI	0	2153	284	239	51.666667	6.666667	-236.133333	-6.666667	50.580035
w68	M	F10005_SI	0	1915	371	305	72.666667	6.666667	-104.133333	-6.666667	48.973420
w76	M	F10005_SI	0	1757	286	376	-83.333333	6.666667	37.866667	-6.666667	45.722386
w79	M	F10005_SI	0	2596	384	583	-192.333333	6.666667	451.866667 -6.666667  67.345540
;

run;

*celan_ase-stack;

data test1;
set test;
Exp=(line+tester)/both;
diff=(tester-line)/both;
tester1=tester/both;
line1=line/both;
*keep geno ms fusionid both line tester exp diff tester1 line1;
run;

proc means data=test1 mean;
by fusionid ms;
var line1 tester1 diff exp;
output out=mean_t1;
run;
data mean_counts;
set mean_t1;
where _stat_="MEAN";
rename _freq_=numobs line1=mean_line1 tester1=mean_tester1 diff=cis_tester exp=mean_exp;
drop _type_;
run;

data mean_counts2;
set mean_counts;
trans_t=2*((mean_tester1)-(mean_exp/2)-cis_tester);
run;

data test2;
merge test1 mean_counts2;
by fusionid ms;

cis_i=((line-tester)/both)+cis_tester;
trans_i=2*(line1-cis_i -(mean_exp/2))-trans_t;
bias=line1/exp;
check_i=(mean_exp/2)+cis_i+((trans_i+trans_t)/2);

run;
*(tester1+line1)/2 is 4.69507755 average for 30 is pop mean;

proc gplot data=test2;

plot bias*cis_i;
plot cis_i*trans_i;
plot line1*cis_i;
plot line1*trans_i;
plot line1*check_i;
plot old_cis_line*cis_i;
plot old_trans_line*trans_i;
run;

proc means data=test2;
run;


proc univariate data=test2 normal plot;
var cis_i trans_i;
run;
